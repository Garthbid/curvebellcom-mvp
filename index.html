<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Curvebell — MVP</title>
  <meta name="description" content="Curvebell MVP — bring your child to the right side of the bell curve." />
  <style>
    :root{
      --bg:#0b0e14; --card:#121826; --muted:#6b7380; --text:#e6eaf2; --accent:#6cf; --ok:#2ecc71; --warn:#f39c12; --err:#e74c3c;
      --ring:0 0 0 3px rgba(102,204,255,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:linear-gradient(180deg, #0b0f1a, #0b0e14 120%);
      color:var(--text);
    }
    .container{max-width:1000px; margin-inline:auto; padding:24px}
    header.site{display:flex; align-items:center; justify-content:space-between; gap:16px}
    .logo{display:flex; align-items:center; gap:12px; font-weight:800; letter-spacing:.2px}
    .logo-mark{
      width:34px; height:34px; border-radius:12px; background: conic-gradient(from 200deg, #6cf, #7f87ff, #6cf);
      display:grid; place-items:center; box-shadow:0 6px 24px rgba(108,204,255,.35);
    }
    .logo-mark::after{content:"∩"; font-weight:900; color:#0b0e14}
    nav small{color:var(--muted)}
    .card{
      background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.06);
      border-radius:18px;
      box-shadow: 0 8px 30px rgba(0,0,0,.25);
      padding:20px;
    }
    .hero{
      display:grid; grid-template-columns: 1.2fr .8fr; gap:22px; align-items:center; margin-top:22px;
    }
    .hero h1{font-size:clamp(28px, 5vw, 46px); line-height:1.05; margin:0 0 8px}
    .hero p{color:#cfd6e6; margin:0 0 18px}
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      background:linear-gradient(180deg, #7fd3ff, #6cb8ff);
      color:#051018; border:none; border-radius:14px; padding:14px 18px; font-weight:800; cursor:pointer;
      box-shadow:0 12px 24px rgba(108,184,255,.35);
    }
    .btn:hover{filter:brightness(1.03)}
    .btn.secondary{background:transparent; color:#cfe7ff; border:1px solid rgba(108,184,255,.32); box-shadow:none}
    .btn:focus-visible{outline:none; box-shadow:var(--ring)}
    .grid-2{display:grid; grid-template-columns:1fr 1fr; gap:16px}
    iframe{width:100%; aspect-ratio:16/9; border:0; border-radius:14px}
    .muted{color:var(--muted)}
    .center{display:grid; place-items:center}
    .page{display:none; animation:fade .25s ease}
    .page.active{display:block}
    @keyframes fade{from{opacity:0; transform:translateY(4px)} to{opacity:1; transform:none}}
    .choice{
      padding:18px; border-radius:14px; border:1px solid rgba(255,255,255,.08); cursor:pointer;
      transition:.15s transform, .15s border-color, .15s background-color;
      background:rgba(255,255,255,.03);
      display:block;
    }
    .choice:hover{transform:translateY(-2px); border-color:rgba(108,184,255,.45); background:rgba(108,184,255,.06)}
    .choice input{margin-right:10px}
    .choice .title{font-weight:800; margin-bottom:6px}
    .price{
      font-size:28px; font-weight:900; letter-spacing:.2px;
    }
    form label{display:block; font-weight:700; margin:10px 0 6px}
    input[type="text"], input[type="number"], textarea, input[type="file"]{
      width:100%; background:#0f1524; color:var(--text); border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:12px 12px;
    }
    textarea{min-height:100px; resize:vertical}
    .row{display:flex; gap:12px; flex-wrap:wrap}
    .row .btn{flex:1}
    .exam-q{
      padding:16px; border-radius:14px; border:1px solid rgba(255,255,255,.08); margin-bottom:14px; background:rgba(255,255,255,.03)
    }
    .exam-q h4{margin:0 0 8px; font-size:16px}
    .exam-q .meta{font-size:12px; color:var(--muted); margin-bottom:8px}
    .exam-q .opts{display:grid; gap:8px}
    .exam-q .opts label{
      display:flex; gap:10px; align-items:flex-start; background:#0f1524; border:1px solid rgba(255,255,255,.06);
      border-radius:10px; padding:10px; cursor:pointer;
    }
    .exam-q .opts input{margin-top:3px}
    .progress{height:10px; width:100%; background:#0e1320; border-radius:999px; overflow:hidden; border:1px solid rgba(255,255,255,.08)}
    .bar{height:100%; width:0%; background:linear-gradient(90deg, #7fd3ff, #6cb8ff); transition:width .25s}
    .pill{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border:1px solid rgba(255,255,255,.12); border-radius:999px; color:#a9b3c7; font-size:12px}
    .result-big{font-size: clamp(32px, 6vw, 64px); font-weight:900; margin:0}
    .badge{padding:6px 10px; border-radius:10px; font-weight:800; color:#041016; background:#6cf; display:inline-block}
    .lessons{display:grid; gap:12px}
    .lessons .lesson{background:#0f1524; border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:14px}
    .small{font-size:12px; color:#a6b2c6}
    .footer{border-top:1px solid rgba(255,255,255,.08); margin-top:22px; padding-top:12px; color:#8c95a8; font-size:12px}
    .sp{height:8px}
    .hide{display:none !important}
    /* Print styles for worksheets */
    @media print{
      body{background:#fff; color:#000}
      header.site, nav, .pill, .footer, .btn{display:none !important}
      .card{background:#fff; border:1px solid #000; box-shadow:none}
      .page{display:block !important}
    }
    .print-grid{display:grid; grid-template-columns:repeat(2,1fr); gap:10px}
    .worksheet-line{display:block; border-bottom:1px dashed #6b7380; margin:8px 0; height:18px}
    .img-preview{max-width:100%; border-radius:12px; border:1px solid rgba(255,255,255,.1)}
  </style>
</head>
<body>
  <div class="container">
    <header class="site">
      <div class="logo">
        <div class="logo-mark" aria-hidden="true"></div>
        <div>
          <div>Curvebell</div>
          <small class="muted">A system designed to bring kids to the right side of the bell curve.</small>
        </div>
      </div>
      <nav><small>v0.2 — MVP</small></nav>
    </header>

    <!-- Landing -->
    <section id="page-landing" class="page active">
      <div class="hero">
        <div class="card">
          <h1>Personalized daily lessons that pull your child to the right side of the bell curve.</h1>
          <p>Start with a quick assessment. We’ll generate tomorrow’s plan automatically. No fluff—just compounding gains.</p>
          <div class="row">
            <button class="btn" id="cta-start">Start Your Journey →</button>
            <button class="btn secondary" onclick="window.scrollTo({top:document.body.scrollHeight, behavior:'smooth'})">Learn more</button>
          </div>
          <div style="height:10px"></div>
          <div class="pill">⚡ 5-step flow · ~10 minutes</div>
        </div>
        <div class="card">
          <iframe title="Curvebell Intro" src="https://www.youtube.com/embed/tgbNymZ7vqY" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
          <div class="small sp"></div>
          <div class="small">Replace the video ID in the iframe with your real intro when ready.</div>
        </div>
      </div>
      <div class="footer">© <span id="year"></span> Curvebell. MVP for demo purposes.</div>
    </section>

    <!-- Journey 1: Choose schooling -->
    <section id="page-choose" class="page">
      <h2>Step 1 — Tell us about school</h2>
      <p class="muted">Which best describes your child?</p>
      <label class="choice">
        <input type="radio" name="schoolType" value="home" />
        <span class="title">Homeschooled</span>
        <div class="muted">Daily 4-hour structured path with parent-guided blocks.</div>
      </label>
      <label class="choice">
        <input type="radio" name="schoolType" value="public" />
        <span class="title">Public/Private School</span>
        <div class="muted">Daily 1-hour focused booster that fits after school.</div>
      </label>
      <div style="height:16px"></div>
      <div class="row">
        <button class="btn secondary" onclick="go('page-landing')">← Back</button>
        <button class="btn" id="to-pricing">Continue →</button>
      </div>
    </section>

    <!-- Journey 2: Pricing -->
    <section id="page-pricing" class="page">
      <h2>Step 2 — Plan & pricing</h2>
      <p class="muted">Based on your selection.</p>
      <div class="grid-2">
        <div class="card" id="plan-summary"></div>
        <div class="card">
          <h3>What you get</h3>
          <ul>
            <li>Daily adaptive lesson plan</li>
            <li>Mastery tracking per skill</li>
            <li>Weekly progress report</li>
            <li>Parent tips & mini challenges</li>
          </ul>
          <div class="sp"></div>
          <div class="pill">Cancel anytime · No hidden fees</div>
        </div>
      </div>
      <div style="height:16px"></div>
      <div class="row">
        <button class="btn secondary" onclick="go('page-choose')">← Back</button>
        <button class="btn" onclick="go('page-form')">Continue →</button>
      </div>
    </section>

    <!-- Journey 3: Child form -->
    <section id="page-form" class="page">
      <h2>Step 3 — Who are we helping?</h2>
      <form id="child-form" onsubmit="event.preventDefault(); startExam()">
        <label for="childName">Full Name</label>
        <input id="childName" name="childName" type="text" required placeholder="e.g., Ava Johnson" />

        <label for="childAge">Age</label>
        <input id="childAge" name="childAge" type="number" min="5" max="14" required placeholder="10" />

        <label for="interests">Special Interests</label>
        <textarea id="interests" name="interests" placeholder="Space, animals, drawing, soccer..."></textarea>

        <div style="height:14px"></div>
        <div class="row">
          <button type="button" class="btn secondary" onclick="go('page-pricing')">← Back</button>
          <button type="submit" class="btn">Start Initial Examination →</button>
        </div>
      </form>
    </section>

    <!-- Journey 4: Exam -->
    <section id="page-exam" class="page">
      <div class="row" style="align-items:center; justify-content:space-between">
        <h2>Step 4 — Initial Examination (25 questions)</h2>
        <div class="pill"><span id="answered-count">0</span>/25 answered</div>
      </div>
      <p class="muted">A mixed-difficulty check across math, reading, logic, science, and core knowledge for typical 8–10-year-olds. Answer your best—no pressure.</p>

      <div class="card">
        <strong>Reading passage (for Q6–Q10):</strong>
        <p style="margin-top:8px; color:#cfd6e6">
          Mia and her dog, Rusty, walked to the park on Saturday morning. Dark clouds gathered and a light rain began. They sat under a big oak tree until the rain stopped. When the sun came out, a bright rainbow appeared, and Mia laughed as Rusty chased his red ball across the shiny grass.
        </p>
      </div>
      <div style="height:10px"></div>

      <div id="exam-questions"></div>

      <div class="card">
        <div class="progress" aria-label="Progress">
          <div class="bar" id="progress-bar"></div>
        </div>
        <div style="height:12px"></div>
        <div class="row">
          <button class="btn secondary" onclick="go('page-form')">← Back</button>
          <button class="btn" id="submit-exam" disabled>Submit Exam →</button>
        </div>
        <div class="small muted sp"></div>
        <div class="small muted">Tip: you can submit with unanswered items, but results are more accurate when all are answered.</div>
      </div>
    </section>

    <!-- Journey 5: Results -->
    <section id="page-result" class="page">
      <div class="grid-2">
        <div class="card">
          <p class="badge">Demo Result</p>
          <h3 style="margin:8px 0 6px">Your child scored at</h3>
          <p class="result-big"><span id="score-pct">0</span>%</p>
          <p class="muted" id="score-sub"></p>
          <div class="sp"></div>
          <div id="category-breakdown" class="small"></div>
        </div>
        <div class="card">
          <h3>Tomorrow’s lesson — pre-built</h3>
          <p class="muted">We target the lowest-scoring areas first to drive the fastest compounding gains.</p>
          <div class="lessons" id="lesson-plan"></div>
          <div class="sp"></div>
          <div id="plan-cta" class="pill"></div>
        </div>
      </div>
      <div style="height:16px"></div>
      <div class="row">
        <button class="btn secondary" onclick="restart()">Start Over</button>
        <button class="btn" onclick="go('page-lesson')">Create Daily Lesson Plan</button>
      </div>
      <div class="footer">This is a demo estimate based on the 25-item screener, not a clinical assessment.</div>
    </section>

    <!-- Journey 6: Daily Lesson Plan (Detailed, Printable) -->
    <section id="page-lesson" class="page">
      <div class="card">
        <p class="badge">Day 1 — Printable Lesson</p>
        <h2 style="margin:8px 0 6px">Daily Lesson Plan — 60 Minutes</h2>
        <p class="small">
          For <strong><span id="lesson-child-name">Your child</span></strong>. Assumed age: <strong>10</strong> · Initial exam: <strong>23%</strong>.
        </p>
        <div class="pill">Materials: pencil, eraser, scrap paper, timer, printed page(s)</div>
      </div>

      <!-- Warm-up -->
      <div class="card">
        <h3>1) Warm-Up Fluency (10 minutes)</h3>
        <p class="muted">Goal: sharpen single-digit facts and quick thinking.</p>
        <div class="print-grid">
          <div>
            <strong>A. Addition (answer mentally)</strong>
            <div>7+5=____  8+6=____  9+4=____  6+7=____  3+9=____  5+8=____</div>
            <div>4+7=____  9+3=____  6+6=____  8+5=____  7+7=____  4+9=____</div>
          </div>
          <div>
            <strong>B. Subtraction</strong>
            <div>13−7=____  15−8=____  11−6=____  14−9=____  12−5=____  16−7=____</div>
            <div>18−9=____  10−4=____  12−8=____  17−9=____  11−3=____  9−5=____</div>
          </div>
        </div>
        <div style="margin-top:8px"><em>Timer:</em> 5 min add + 5 min subtract. Parent circles items needing practice.</div>
      </div>

      <!-- Reading -->
      <div class="card">
        <h3>2) Reading & Comprehension (15 minutes)</h3>
        <p><strong>Read aloud:</strong> <em>The Sandcastle Plan</em></p>
        <p style="color:#cfd6e6">
          On a breezy afternoon, Maya and her brother Eli brought three buckets to the beach: one for water, one for sand, and one for shells.
          They planned the tallest sandcastle they had ever built. First they marked a wide circle with a stick. Then Maya packed wet sand into a big bucket while Eli fetched
          more water before the walls could dry. Seagulls wheeled overhead as their castle grew towers, windows, and a winding shell path to the gate.
          When a wave rolled closer, the moat they dug caught the water and held it like a glittering bracelet. A little boy asked how they kept
          the towers from falling. “We pack the sand tight and add water slowly,” Maya explained. By sunset, the castle stood firm. Maya and Eli took a photo,
          knowing the tide would erase it by morning—but their plan had worked.
        </p>
        <ol>
          <li>Main idea in one sentence: <span class="worksheet-line"></span></li>
          <li>Why did they dig a moat? <span class="worksheet-line"></span></li>
          <li>What materials did they use? <span class="worksheet-line"></span></li>
          <li>What tip did Maya share? <span class="worksheet-line"></span></li>
          <li>Circle the best title: <em>Beach Games</em> / <em>Building with a Plan</em> / <em>Shell Hunting</em></li>
        </ol>
      </div>

      <!-- Vocabulary -->
      <div class="card">
        <h3>3) Vocabulary (10 minutes)</h3>
        <p class="muted">Say each word, guess the meaning, then write a sentence.</p>
        <ol>
          <li><strong>bracelet</strong> (context: a ring around the moat): <span class="worksheet-line"></span></li>
          <li><strong>wheeled</strong> (as birds move): <span class="worksheet-line"></span></li>
          <li><strong>packed</strong> (sand tightly): <span class="worksheet-line"></span></li>
          <li><strong>erase</strong> (what the tide will do): <span class="worksheet-line"></span></li>
          <li><strong>planned</strong> (made a plan): <span class="worksheet-line"></span></li>
        </ol>
      </div>

      <!-- Math Foundations -->
      <div class="card">
        <h3>4) Math Foundations (15 minutes)</h3>
        <div class="print-grid">
          <div>
            <strong>A. Multiplication facts (2s, 3s, 4s)</strong>
            <div>2×3=__  2×7=__  2×9=__  3×4=__  3×6=__  3×8=__  4×3=__  4×4=__  4×6=__  4×8=__  3×9=__  2×8=__</div>
          </div>
          <div>
            <strong>B. Word problems</strong>
            <ol>
              <li>A sticker costs 4¢. You buy 6. Total = __¢</li>
              <li>There are 3 bags with 8 marbles each. Marbles = __</li>
              <li>2 boxes hold 4 pencils each, plus 3 more pencils. Total = __</li>
            </ol>
          </div>
        </div>
      </div>

      <!-- Logic -->
      <div class="card">
        <h3>5) Critical Thinking (10 minutes)</h3>
        <ol>
          <li><strong>Pattern:</strong> 2, 4, 6, 8, __, __</li>
          <li><strong>Odd one out:</strong> cat · dog · cow · tree → __</li>
          <li><strong>Analogy:</strong> Bird : sky :: fish : __</li>
        </ol>
      </div>

      <!-- Parent checklist & Answer Key -->
      <div class="card">
        <h3>Parent Checklist</h3>
        <ul>
          <li>Kept to 60 minutes (+/− 5)</li>
          <li>Reading done aloud; questions answered in full sentences</li>
          <li>Math facts attempted without calculator</li>
          <li>Encouraged child to explain reasoning (math + logic)</li>
        </ul>
        <details>
          <summary><strong>Answer Key (for parent)</strong></summary>
          <div class="small">
            <p><strong>Warm-Up:</strong> add/sub mental accuracy, mark misses.</p>
            <p><strong>Reading:</strong> 1) planning/building a sandcastle with a plan; 2) to catch/slow incoming waves; 3) water, sand, shells, bucket, stick; 4) pack sand tight and add water slowly; 5) “Building with a Plan”.</p>
            <p><strong>Vocab (sample meanings):</strong> bracelet: ring/loop; wheeled: circled/turned; packed: pressed tightly; erase: remove/wipe away; planned: decided steps ahead of time.</p>
            <p><strong>Math A:</strong> 6,14,18,12,18,24,12,16,24,32,27,16.</p>
            <p><strong>Math B:</strong> 24¢; 24; 11.</p>
            <p><strong>Logic:</strong> pattern → 10, 12; odd one out → tree; analogy → water.</p>
          </div>
        </details>
      </div>

      <div class="row">
        <button class="btn secondary" onclick="go('page-result')">← Back to Results</button>
        <button class="btn" onclick="window.print()">Print Today’s Lesson</button>
        <button class="btn" onclick="go('page-upload')">Upload Completed Lesson →</button>
      </div>
      <div class="small muted">Tip: Take a clear photo of the filled worksheet(s) for analysis.</div>
    </section>

    <!-- Journey 7: Upload Completed Lesson -->
    <section id="page-upload" class="page">
      <div class="card">
        <p class="badge">Upload</p>
        <h2>Submit Today’s Work</h2>
        <p class="muted">Upload a clear photo of the completed lesson (JPEG/PNG). For demo, we’ll simulate analysis.</p>
        <input id="upload-input" type="file" accept="image/*" />
        <div style="height:12px"></div>
        <img id="upload-preview" class="img-preview hide" alt="Preview"/>
      </div>
      <div class="row">
        <button class="btn secondary" onclick="go('page-lesson')">← Back to Lesson</button>
        <button id="analyze-btn" class="btn" disabled>Analyze →</button>
      </div>
      <div class="small muted">Note: In production, this image would be analyzed by our vision model (OCR + rubric scoring).</div>
    </section>

    <!-- Journey 8: Analysis & Tomorrow Plan -->
    <section id="page-analysis" class="page">
      <div class="card">
        <p class="badge">Analysis (Demo)</p>
        <h2>Feedback Summary</h2>
        <p class="muted">We reviewed your upload (demo mode). Here’s targeted feedback and tomorrow’s auto-generated plan.</p>
        <ul id="analysis-feedback">
          <!-- filled by JS -->
        </ul>
      </div>

      <div class="card">
        <h3>Tomorrow’s Lesson Plan (Auto-Generated Demo)</h3>
        <p class="small">Focus is based on the weakest areas from exam + today’s (simulated) performance.</p>
        <div id="tomorrow-plan">
          <!-- filled by JS -->
        </div>
      </div>

      <div class="row">
        <button class="btn secondary" onclick="go('page-upload')">← Back to Upload</button>
        <button class="btn" onclick="window.print()">Print Tomorrow’s Lesson</button>
        <button class="btn" onclick="go('page-upload')">After Tomorrow, Upload Again →</button>
      </div>
      <div class="footer">Demo: No real image processing yet. The loop repeats daily: print → complete → upload → analyze → improve.</div>
    </section>
  </div>

  <script>
    const state = {
      schoolType: null, // 'home' | 'public'
      plan: { label: "", price: 0, hours: 0 },
      child: { name: "", age: 10, interests: "" },
      answers: {}, // { [id]: index }
      results: null,
      lastUploadUrl: null
    };

    const plans = {
      home: { label: "Homeschooled Plan", price: 175, hours: 4, blurb: "Structured 4-hour daily plan tailored for home learning." },
      public: { label: "After-School Booster", price: 75, hours: 1, blurb: "Focused 1-hour daily plan that fits after school." }
    };

    const questions = (() => {
      let id=0;
      const E="easy", M="medium", H="hard";
      const Q = [];

      // 1–5 Math
      Q.push({id:++id, cat:"Math", diff:E, q:"What is 9 + 6?", opts:["13","14","15","16"], a:2});
      Q.push({id:++id, cat:"Math", diff:M, q:"What is 24 − 8?", opts:["14","16","18","12"], a:1});
      Q.push({id:++id, cat:"Math", diff:M, q:"What is 3 × 4?", opts:["7","8","12","16"], a:2});
      Q.push({id:++id, cat:"Math", diff:H, q:"A book costs $7. If you buy 2 books with $20, how much change do you get?", opts:["$6","$7","$14","$8"], a:0});
      Q.push({id:++id, cat:"Math", diff:E, q:"Which fraction is the same as 1/2?", opts:["1/3","2/4","3/4","2/3"], a:1});

      // 6–10 Reading (based on passage)
      Q.push({id:++id, cat:"Reading", diff:M, q:"What is the main idea of the passage?", opts:["Mia stayed home because it rained.","Mia and Rusty enjoyed the park even though it rained.","Rusty lost his red ball.","The oak tree was cut down."], a:1});
      Q.push({id:++id, cat:"Reading", diff:E, q:"Why did Mia and Rusty sit under the oak tree?", opts:["To see a rainbow.","To eat lunch.","To stay dry while it rained.","To climb the tree."], a:2});
      Q.push({id:++id, cat:"Reading", diff:E, q:"What happened after the rain stopped?", opts:["They went home.","A bright rainbow appeared.","They bought ice cream.","It started snowing."], a:1});
      Q.push({id:++id, cat:"Reading", diff:M, q:"What does 'gathered' most nearly mean in the passage?", opts:["went away","came together","shouted","played"], a:1});
      Q.push({id:++id, cat:"Reading", diff:M, q:"What did Rusty chase across the shiny grass?", opts:["a blue frisbee","a squirrel","his red ball","a kite"], a:2});

      // 11–15 Logic/Patterns
      Q.push({id:++id, cat:"Logic", diff:E, q:"What number comes next: 2, 4, 6, 8, __ ?", opts:["9","10","11","12"], a:1});
      Q.push({id:++id, cat:"Logic", diff:M, q:"Which shape has exactly 3 sides?", opts:["Square","Triangle","Rectangle","Circle"], a:1});
      Q.push({id:++id, cat:"Logic", diff:M, q:"Which is the odd one out?", opts:["Cat","Dog","Cow","Tree"], a:3});
      Q.push({id:++id, cat:"Logic", diff:H, q:"If today is Tuesday, what day will it be in three days?", opts:["Wednesday","Thursday","Friday","Saturday"], a:2});
      Q.push({id:++id, cat:"Logic", diff:M, q:"Bird is to sky as fish is to __", opts:["tree","sand","water","clouds"], a:2});

      // 16–20 Science
      Q.push({id:++id, cat:"Science", diff:E, q:"Water freezes at what temperature (°C)?", opts:["100°","0°","10°","−10°"], a:1});
      Q.push({id:++id, cat:"Science", diff:M, q:"Which part of a plant makes food from sunlight?", opts:["Roots","Stem","Leaves","Flowers"], a:2});
      Q.push({id:++id, cat:"Science", diff:E, q:"Which planet do we live on?", opts:["Mars","Venus","Earth","Jupiter"], a:2});
      Q.push({id:++id, cat:"Science", diff:M, q:"What force pulls objects toward Earth?", opts:["Friction","Magnetism","Electricity","Gravity"], a:3});
      Q.push({id:++id, cat:"Science", diff:H, q:"Which material is the best conductor of electricity?", opts:["Wood","Rubber","Copper","Glass"], a:2});

      // 21–25 Core Knowledge
      Q.push({id:++id, cat:"Core", diff:E, q:"How many minutes are in one hour?", opts:["30","45","60","90"], a:2});
      Q.push({id:++id, cat:"Core", diff:M, q:"Which day comes after Thursday?", opts:["Tuesday","Friday","Sunday","Monday"], a:1});
      Q.push({id:++id, cat:"Core", diff:M, q:"You have two quarters and one dime. How much money is that?", opts:["40¢","50¢","60¢","70¢"], a:2});
      Q.push({id:++id, cat:"Core", diff:M, q:"A rectangle has how many right angles?", opts:["2","3","4","5"], a:2});
      Q.push({id:++id, cat:"Core", diff:E, q:"Which punctuation mark ends a question?", opts:[".","!","?",";"], a:2});

      return Q;
    })();

    const diffWeight = { easy:1, medium:2, hard:3, Easy:1, Medium:2, Hard:3, E:1, M:2, H:3 };

    // Render helpers
    function go(id){ document.querySelectorAll('.page').forEach(p=>p.classList.remove('active')); document.getElementById(id).classList.add('active'); window.scrollTo({top:0,behavior:'smooth'}); }
    document.getElementById('cta-start').addEventListener('click', ()=>go('page-choose'));
    document.getElementById('year').textContent = new Date().getFullYear();

    // Choose schooling → pricing
    document.getElementById('to-pricing').addEventListener('click', ()=>{
      const choice = [...document.querySelectorAll('input[name="schoolType"]')].find(i=>i.checked);
      if(!choice){ alert("Please select one to continue."); return; }
      state.schoolType = choice.value;
      state.plan = plans[state.schoolType];
      const el = document.getElementById('plan-summary');
      el.innerHTML = `
        <h3>${state.plan.label}</h3>
        <div class="price">$${state.plan.price}/month</div>
        <div class="muted">${state.plan.blurb}</div>
        <div class="sp"></div>
        <ul>
          <li>${state.plan.hours} hours per day</li>
          <li>Adaptive difficulty curve</li>
          <li>Parent dashboard</li>
        </ul>
      `;
      go('page-pricing');
    });

    // Child form
    function startExam(){
      const name = document.getElementById('childName').value.trim();
      const age = parseInt(document.getElementById('childAge').value,10);
      const interests = document.getElementById('interests').value.trim();
      if(!name || !age){ alert("Please provide your child's name and age."); return; }
      state.child = { name, age, interests };
      buildExam();
      go('page-exam');
    }

    // Build exam UI
    function buildExam(){
      const wrap = document.getElementById('exam-questions');
      wrap.innerHTML = "";
      questions.forEach(q=>{
        const qEl = document.createElement('div');
        qEl.className = 'exam-q';
        qEl.innerHTML = `
          <h4>Q${q.id}. ${q.q}</h4>
          <div class="meta">${q.cat} · <span class="muted">${q.diff[0].toUpperCase() + q.diff.slice(1)} difficulty</span></div>
          <div class="opts">
            ${q.opts.map((opt,idx)=>`
              <label>
                <input type="radio" name="q${q.id}" value="${idx}" ${state.answers[q.id]===idx?'checked':''}/>
                <span>${String.fromCharCode(65+idx)}. ${opt}</span>
              </label>
            `).join('')}
          </div>
        `;
        wrap.appendChild(qEl);
      });

      wrap.querySelectorAll('input[type="radio"]').forEach(inp=>{
        inp.addEventListener('change', e=>{
          const name = e.target.name; // q{id}
          const id = parseInt(name.slice(1),10);
          state.answers[id] = parseInt(e.target.value,10);
          updateProgress();
        });
      });

      updateProgress();
      document.getElementById('submit-exam').onclick = submitExam;
    }

    function updateProgress(){
      const answered = Object.keys(state.answers).length;
      document.getElementById('answered-count').textContent = answered;
      const pct = Math.round((answered / questions.length) * 100);
      document.getElementById('progress-bar').style.width = pct + "%";
      document.getElementById('submit-exam').disabled = answered === 0;
    }

    function submitExam(){
      // scoring
      let gained = 0, max = 0;
      const byCat = {}; // {cat:{g:0,max:0}}
      questions.forEach(q=>{
        const w = diffWeight[q.diff] ?? 1;
        max += w;
        byCat[q.cat] ??= { g:0, max:0 };
        byCat[q.cat].max += w;
        const picked = state.answers[q.id];
        if(picked === q.a){
          gained += w;
          byCat[q.cat].g += w;
        }
      });
      const pct = Math.round( (gained / max) * 100 );
      state.results = { pct, gained, max, byCat };

      // results page fill
      document.getElementById('score-pct').textContent = pct;
      const sub = document.getElementById('score-sub');
      const name = state.child.name.split(" ")[0] || "Your child";
      sub.textContent = `${name} answered ${Object.keys(state.answers).length} of ${questions.length} items. Weighted score ${gained}/${max}.`;

      // show child's name on Lesson page as well
      const nameSlot = document.getElementById('lesson-child-name');
      if (nameSlot) nameSlot.textContent = name;

      // breakdown
      const bd = document.getElementById('category-breakdown');
      const items = Object.entries(byCat).map(([cat, v])=>{
        const p = Math.round((v.g/v.max)*100);
        return `<div class="pill">${cat}: ${p}%</div>`;
      }).join(' ');
      bd.innerHTML = `<div class="row" style="gap:8px">${items}</div>`;

      // lessons from weakest two categories for result preview
      const ranked = Object.entries(byCat)
        .map(([cat,v])=>({cat, pct: Math.round((v.g/v.max)*100)}))
        .sort((a,b)=>a.pct-b.pct);
      const focus = ranked.slice(0,2).map(x=>x.cat);

      const prescriptions = {
        "Math":[
          "10-minute warm-up: skip-counting by 2s, 3s, 4s.",
          "Fluency: single-digit × and ÷ flash (5 minutes).",
          "Word problems: 3 real-life money or time problems.",
          "Challenge: one multi-step problem aloud—explain thinking."
        ],
        "Reading":[
          "Read a 2-paragraph story aloud; parent asks 3 who/what/why questions.",
          "Find 3 new words; guess meanings from context, then check.",
          "Sequence: retell events in order; write 3 sentences.",
          "Fluency: 5 minutes timed reading; mark tricky words."
        ],
        "Logic":[
          "Pattern practice: finish 8 number/shape sequences.",
          "Analogies: do 6 simple analogies together.",
          "Calendar math: +/− days from today (3 examples).",
          "Game: 10 minutes of chess puzzles or tangrams."
        ],
        "Science":[
          "Mini-lab: freeze/melt water; note temperature change.",
          "Plant study: label leaf, stem, root; sunlight journal.",
          "Forces: test gravity vs. friction with a toy car ramp.",
          "Space fact: draw Earth and the Moon; discuss orbits."
        ],
        "Core":[
          "Time: read clocks at :15/:30/:45; convert to minutes.",
          "Money: make 4 amounts with coins; add and compare.",
          "Geography: label continents & oceans from memory.",
          "Writing: 5 question sentences (use '?') about a photo."
        ]
      };

      const lp = document.getElementById('lesson-plan');
      lp.innerHTML = focus.map(cat=>{
        const list = prescriptions[cat].slice(0,4).map(item=>`<li>${item}</li>`).join("");
        return `
          <div class="lesson">
            <strong>${cat} Focus (≈ ${state.plan.hours ? Math.max(15, Math.round(60/state.plan.hours)) : 30} min total)</strong>
            <ul style="margin:8px 0 0 18px">${list}</ul>
          </div>
        `;
      }).join("");

      const planCta = document.getElementById('plan-cta');
      planCta.textContent = `${state.plan.label || 'Daily Plan'} · ${state.plan.hours || 1}h/day`;

      go('page-result');
    }

    function restart(){
      state.schoolType = null;
      state.plan = { label:"", price:0, hours:0 };
      state.child = { name:"", age:10, interests:"" };
      state.answers = {};
      state.results = null;
      state.lastUploadUrl = null;
      // UI reset
      document.querySelectorAll('input[name="schoolType"]').forEach(i=>i.checked=false);
      const form = document.getElementById('child-form'); if(form) form.reset();
      document.getElementById('exam-questions').innerHTML = "";
      document.getElementById('answered-count').textContent = "0";
      document.getElementById('progress-bar').style.width = "0%";
      const submitBtn = document.getElementById('submit-exam'); if (submitBtn) submitBtn.disabled = true;
      const prev = document.getElementById('upload-preview'); if(prev){ prev.src=""; prev.classList.add('hide'); }
      const upBtn = document.getElementById('analyze-btn'); if(upBtn){ upBtn.disabled = true; }
      go('page-landing');
    }

    // Upload page handlers (demo)
    const uploadInput = document.getElementById('upload-input');
    const uploadPreview = document.getElementById('upload-preview');
    const analyzeBtn = document.getElementById('analyze-btn');

    if (uploadInput){
      uploadInput.addEventListener('change', (e)=>{
        const file = e.target.files && e.target.files[0];
        if(!file){ analyzeBtn.disabled = true; return; }
        const url = URL.createObjectURL(file);
        state.lastUploadUrl = url;
        uploadPreview.src = url;
        uploadPreview.classList.remove('hide');
        analyzeBtn.disabled = false;
      });
    }

    if (analyzeBtn){
      analyzeBtn.addEventListener('click', ()=>{
        // DEMO "analysis": derive focus from initial exam; pretend performance
        const name = state.child.name.split(" ")[0] || "Your child";
        const res = state.results;
        let weak = ["Math","Reading"]; // default
        if (res && res.byCat){
          weak = Object.entries(res.byCat)
            .map(([cat,v])=>({cat, pct: Math.round((v.g/v.max)*100)}))
            .sort((a,b)=>a.pct-b.pct).slice(0,2).map(x=>x.cat);
        }

        // Fake rubric outcomes
        const feedbackList = [
          `${name} showed improved stamina completing a full hour.`,
          `Fluency: ~60% accuracy on single-digit facts; missteps on 7± and 8± facts.`,
          `Reading: answered 3/5 comprehension questions — needs more “why/how” practice.`,
          `Math foundations: ~40% on 2s/3s/4s tables; errors rose with 3× and 4×.`,
          `Logic: 2/3 correct with solid verbal reasoning.`
        ];
        const fbUl = document.getElementById('analysis-feedback');
        fbUl.innerHTML = feedbackList.map(x=>`<li>${x}</li>`).join("");

        // Tomorrow plan — target weakest two cats
        const nextPrescriptions = {
          "Math":[
            "<strong>Fluency (10 min):</strong> 7± and 8± add/sub deck (20 cards).",
            "<strong>Tables (15 min):</strong> 3× & 4× ladder practice; chant + write.",
            "<strong>Word problems (10 min):</strong> 4 money/time problems; explain aloud.",
            "<strong>Checkpoint (5 min):</strong> 10 mixed facts; goal 80%+."
          ],
          "Reading":[
            "<strong>Read aloud (10 min):</strong> 2 short paragraphs; pause to paraphrase.",
            "<strong>Questioning (10 min):</strong> 5 Why/How prompts; require evidence from text.",
            "<strong>Vocabulary (5 min):</strong> 4 words from text; define + use in a sentence.",
            "<strong>Retell (5 min):</strong> Sequence beginning–middle–end in 3 sentences."
          ],
          "Logic":[
            "<strong>Puzzles (10 min):</strong> 6 analogies; discuss relationships.",
            "<strong>Patterns (10 min):</strong> build/extend 2 arithmetic sequences.",
            "<strong>Game (5 min):</strong> 5 chess mate-in-one puzzles."
          ],
          "Science":[
            "<strong>Mini-lab (10 min):</strong> mass vs. volume with water and cups.",
            "<strong>Concept (10 min):</strong> gravity vs. friction examples at home."
          ],
          "Core":[
            "<strong>Time (10 min):</strong> read clocks at :15/:30/:45; convert to minutes.",
            "<strong>Money (10 min):</strong> make 4 amounts with coins; compare values."
          ]
        };

        const chosenCats = weak;
        const planHtml = chosenCats.map(cat=>{
          const items = (nextPrescriptions[cat]||[]).map(i=>`<li>${i}</li>`).join("");
          return `
            <div class="lesson" style="margin-bottom:8px">
              <strong>${cat} Focus</strong>
              <ul style="margin:6px 0 0 18px">${items}</ul>
            </div>
          `;
        }).join("");

        document.getElementById('tomorrow-plan').innerHTML = `
          <div class="lessons">
            ${planHtml}
            <div class="lesson"><strong>Motivation (5 min):</strong> praise effort; note 1 win; set a tiny goal for tomorrow.</div>
          </div>
        `;

        go('page-analysis');
      });
    }

    // Init
    document.getElementById('cta-start').addEventListener('click', ()=>go('page-choose'));
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
